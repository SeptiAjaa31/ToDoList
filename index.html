<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To DO List - App</title>
    <link rel="stylesheet" href="todo.css">
</head>
<body>
    
    <form action="to-do List" id="form-todo">
        <div class="list">
            <input type="text" name="content" id="content" class="judul" placeholder="Masukan Teks...">
            <textarea name="deskripsi" id="deskripsi" placeholder="Masukan Deskripsi..."></textarea>
            <button type="submit" id="todo-submit">Submit</button>
        </div>
    </form>

    <ul id="todo-list">

    </ul>

    <script>
        const form = document.getElementById('form-todo');
        const content = document.getElementById('content');
        const deskripsi = document.getElementById('deskripsi');
        const todolist = document.getElementById('todo-list');
        
        form.addEventListener('submit', function(e){
            e.preventDefault();

            //alert todo jika belum diisi
            const value = content.value;
            if(!value){
                alert('todo list harus diisi!');
                return;
            }

            const value2 = deskripsi.value;
            if(!value2){
                alert('Deskripsi harus diisi!');
                return;
            }

            alert('Todolist berhasil ditambahkan!');

            //simpan data ke local
            let todos = localStorage.getItem('todo');
            todos = todos ? JSON.parse(todos) : [];

            todos.push({value,value2});

            localStorage.setItem('todo', JSON.stringify(todos));
            console.log(todos);
            renderTodos();
            content.value = '';
            deskripsi.value = '';
        });

        function renderTodos() {
            const stored = localStorage.getItem('todo');
            const arr = stored ? JSON.parse(stored) : [];
            todolist.innerHTML = '';
            arr.forEach(function(t, idx){
                const li = document.createElement('li');
                const span = document.createElement('span');
                span.innerHTML = "<strong>" + t.value + "</strong>Deskripsi: " + t.value2;

                //tombol edit
                const editBtn = document.createElement('button');
                editBtn.type = 'button';
                editBtn.textContent = 'Edit';

                //edit
                editBtn.addEventListener('click', function(){
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.value = t.value;

                    const deskripsiInput = document.createElement('textarea')
                    deskripsiInput.type = 'text'
                    deskripsiInput.value = t.value2

                    //tombol save
                    const saveBtn = document.createElement('button');
                    saveBtn.type = 'button';
                    saveBtn.textContent = 'save';

                    //tombol cancel
                    const cancelBtn = document.createElement('button');
                    cancelBtn.type = 'button';
                    cancelBtn.textContent = 'cancel';

                    //cance/
                    cancelBtn.addEventListener('click', function(){
                        renderTodos();
                    });

                    //cancel esc
                    document.addEventListener('keydown', function(event){
                        if(event.key === 'Escape'){
                            event.preventDefault();
                            cancelBtn.click();
                        }
                    });

                    //save manual
                    saveBtn.addEventListener('click', function(){
                        const newVal = {
                            value: input.value,
                            value2: deskripsiInput.value
                        };
                        if(confirm('Yakin ingin mengubah todolist ini?')){
                            alert('todo berhasil disimpan!');
                        if(!newVal) return;
                        const current = localStorage.getItem('todo');
                        const listArr = current ? JSON.parse(current) : [];
                        listArr[idx] = newVal;
                        localStorage.setItem('todo', JSON.stringify(listArr));
                        renderTodos();
                        }
                    });

                    //save enter
                    input.addEventListener('keydown', function(event){
                        if(event.key === 'Enter'){
                            event.preventDefault();
                            saveBtn.click();
                            renderTodos();
                        }
                    });

                    cancelBtn.addEventListener('click', function(){
                        renderTodos();
                    });

                    //tambah tombol
                    li.innerHTML = '';
                    li.appendChild(input);
                    li.appendChild(deskripsiInput);
                    li.appendChild(saveBtn);
                    li.appendChild(cancelBtn);
                    input.focus();
                });

                //tombol delete
                const deleteBtn = document.createElement('button');
                deleteBtn.type = 'button';
                deleteBtn.textContent = 'Delete';
                deleteBtn.addEventListener('click', function(){
                    if(confirm('Yakin ingin menghapus todolist ini?')){
                        alert('todo berhasil dihapus!');
                        arr.splice(idx, 1);
                        localStorage.setItem('todo', JSON.stringify(arr));
                        renderTodos();
                    }
                });

                    const btnGroup = document.createElement('div');
                    btnGroup.className = 'btn-group';
                    btnGroup.appendChild(editBtn);
                    btnGroup.appendChild(deleteBtn);
                    li.appendChild(span);
                    li.appendChild(btnGroup);
                    todolist.appendChild(li);
            });
        }
        renderTodos();
    </script>
</body>
</html>